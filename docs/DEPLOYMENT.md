# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é Xray XHTTP —Å–µ—Ä–≤–µ—Ä–∞

–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ Xray —Å–µ—Ä–≤–µ—Ä–∞ —Å XHTTP, TLS 1.2/1.3, Reality –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π .env.

## üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ - –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞

```bash
curl -fsSL https://raw.githubusercontent.com/cherdanalex/xray-xhttp-tls12-config/main/install-direct.sh -o /tmp/install.sh && sudo bash /tmp/install.sh
```

**–í–Ω—É—Ç—Ä–∏ —É–∂–µ –≤—Å—ë —Å–ø—Ä–æ—Å–∏—Ç –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç!**

## üìã –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

### 1. –°–±–æ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
–°–∫—Ä–∏–ø—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ:

#### –î–æ–º–µ–Ω
```
Enter your domain name (e.g., example.com): yourdomain.com
```
- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º –¥–æ–º–µ–Ω–æ–º
- –î–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
- –ù–µ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª (http://) –∏–ª–∏ –ø—É—Ç—å

#### Email –¥–ª—è Let's Encrypt
```
Enter your email for Let's Encrypt: your@email.com
```
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞—Ö
- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º email –∞–¥—Ä–µ—Å–æ–º

#### SSH –ø–æ—Ä—Ç
```
Enter SSH port (default: 22): 22
```
- –ü–æ—Ä—Ç –¥–ª—è SSH –¥–æ—Å—Ç—É–ø–∞
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 22
- **–í–ê–ñ–ù–û**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–Ω–∞–µ—Ç–µ —ç—Ç–æ—Ç –ø–æ—Ä—Ç!

#### UUID –∫–ª–∏–µ–Ω—Ç–∞
```
Enter UUID for Xray client (press Enter to generate): 
```
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
- –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–í–ê–ñ–ù–û**: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ—Ç UUID!

#### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç Xray
```
Enter Xray internal port (default: 10000): 10000
```
- –ü–æ—Ä—Ç –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –æ–±—â–µ–Ω–∏—è Xray —Å Nginx
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 10000

### 2. –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `.env`:

```bash
# Xray XHTTP Server Configuration
DOMAIN=yourdomain.com
EMAIL=your@email.com
SSH_PORT=22
XRAY_UUID=12345678-1234-1234-1234-123456789abc
XRAY_PORT=10000

# Reality Keys (DO NOT SHARE)
REALITY_PRIVATE_KEY=your-private-key-here
REALITY_PUBLIC_KEY=your-public-key-here
REALITY_SHORT_ID=abcd1234
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã** - –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–∞–∫–µ—Ç—ã
- **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: Xray, Nginx, Certbot, UFW
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ firewall** - —Å idempotency –∏ —á–∏—Å—Ç–æ–π –∫–æ–ø–∏–µ–π –ø—Ä–∞–≤–∏–ª
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx** - —Å–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –ø—Ä–æ–∫—Å–∏ —Å XHTTP –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- **–ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞** - —á–µ—Ä–µ–∑ Let's Encrypt
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Xray** - —Å–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–µ—Ä–≤–µ—Ä–∞ —Å XHTTP
- **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤** - —Å—Ç–∞—Ä—Ç—É–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** - –¥–æ–±–∞–≤–ª—è–µ—Ç cron –∑–∞–¥–∞—á–∏

## üîÑ Idempotency –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫

### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫
```bash
# –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ —Å–ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo ./scripts/deploy.sh
```

–ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ:
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `.env` —Ñ–∞–π–ª
- ‚úÖ –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –ø–µ—Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (y/N)
- ‚úÖ Firewall –ø—Ä–∞–≤–∏–ª–∞ –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
# –°—Ç–∞—Ç—É—Å Xray
sudo systemctl status xray

# –°—Ç–∞—Ç—É—Å Nginx
sudo systemctl status nginx

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
sudo netstat -tlnp | grep -E ':(80|443|10000)'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
openssl s_client -connect $DOMAIN:443 -servername $DOMAIN

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ certbot
sudo certbot certificates
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
```bash
# –õ–æ–≥–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
sudo tail -f /var/log/xray-deploy.log

# –õ–æ–≥–∏ Xray
sudo tail -f /var/log/xray/error.log

# –õ–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/error.log
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
```bash
# –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
sudo ./scripts/update-cert.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ cron –∑–∞–¥–∞—á
sudo crontab -l
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
```bash
# –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è .env —Ñ–∞–π–ª–∞
export $(cat .env | xargs)
sudo envsubst < configs/xray-server.json.example > /etc/xray/config.json
sudo envsubst < configs/nginx-xray-proxy.conf.example > /etc/nginx/sites-available/xray-proxy
sudo systemctl reload xray nginx
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ firewall –ø—Ä–∞–≤–∏–ª
```bash
# –¢–µ–∫—É—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞
sudo ufw status

# –ß–∏—Å—Ç–∞—è –∫–æ–ø–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥–µ
cat configs/ufw-rules.conf
```

## üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ `client-configs/xray-client.json` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞—à–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞.

### –ö–ª–∏–µ–Ω—Ç—ã —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π XHTTP

- **v2rayN** (Windows) - –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è
- **v2rayNG** (Android) - –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è
- **Xray-core** (CLI) - –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º

## üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl stop xray nginx
sudo systemctl disable xray nginx

# –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
sudo rm -rf /etc/xray
sudo rm -f /etc/nginx/sites-available/xray-proxy
sudo rm -f /etc/nginx/sites-enabled/xray-proxy

# –£–¥–∞–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
sudo certbot delete --cert-name $DOMAIN

# –£–¥–∞–ª–µ–Ω–∏–µ Xray
bash -c "$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)" @ remove

# –£–¥–∞–ª–µ–Ω–∏–µ cron –∑–∞–¥–∞—á
sudo crontab -l | grep -v "update-cert.sh" | sudo crontab -

# –£–¥–∞–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤
sudo rm -f /var/log/xray-deploy.log
sudo rm -rf /var/log/xray
```

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** —Å –ø–æ–º–æ—â—å—é –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–ª–∏–µ–Ω—Ç** —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏–∑ `client-configs/xray-client.json`
3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º
4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
5. **–°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

## üÜò –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–º–æ—â–∏

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [TROUBLESHOOTING.md](TROUBLESHOOTING.md)
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
4. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ DNS –Ω–∞—Å—Ç—Ä–æ–µ–∫
